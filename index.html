<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DCAS CPG Review - Soliman Anas</title>
    
    <script>
    /* Viewport Fix - Runs immediately */
    function setVH() {
        document.documentElement.style.setProperty('--vh', window.innerHeight * 0.01 + 'px');
    }
    setVH();
    window.addEventListener('resize', setVH);
    window.addEventListener('orientationchange', setVH);
    </script>

    <style>
        :root {
            /* Aero Vista Palette */
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.6);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.25);
            --primary-gradient: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            --header-gradient: linear-gradient(to right, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            
            --text-dark: #1a2a3a;
            --text-light: #ffffff;
            
            --success-bg: rgba(212, 237, 218, 0.8);
            --success-text: #155724;
            --info-bg: rgba(209, 236, 241, 0.8);
            --info-text: #0c5460;
            --error-bg: rgba(248, 215, 218, 0.8);
            --error-text: #721c24;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            /* Deep Abstract Background */
            background: #0f2027; 
            background: -webkit-linear-gradient(to right, #2c5364, #203a43, #0f2027); 
            background: linear-gradient(to right, #2c5364, #203a43, #0f2027); 
            
            margin: 0;
            padding: 0;
            padding-top: env(safe-area-inset-top);
            color: var(--text-dark);
            min-height: calc(var(--vh, 1vh) * 100);
            display: flex;
            flex-direction: column;
            touch-action: manipulation;
        }

        /* What are you doing in my code, If you need any help you can reach out ((Soliman Anas)) ü§î*/
        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-light);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px; 
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .home-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 14px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            display: none; 
            transition: all 0.2s ease;
        }
        .home-btn:active { background: rgba(255,255,255,0.4); transform: scale(0.95); }

        .header-text h1 { margin: 0; font-size: 1.2rem; font-weight: 700; letter-spacing: 0.5px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .header-text p { margin: 2px 0 0; font-size: 0.85rem; opacity: 0.9; font-weight: 300; }

        /* --- MAIN LAYOUT --- */
        main {
            flex: 1 0 auto;
            min-height: 0;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding-bottom: 80px; 
        }

        /* Sections Visibility */
        .section { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .section.active { display: block; opacity: 1; animation: slideUp 0.4s ease-out; }
        #home-section { display: block; opacity: 1; }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- Are you still interested in my code üòÅ, With love from Soliman Anas --- */
        .menu-grid { display: grid; gap: 20px; }
        
        .menu-card, .quiz-container, .quiz-setup-container, .sum-card {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--glass-shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }
        
        /* --- Are you still interested in my code üòÅ, With love from Soliman Anas --- */
        .menu-card::before, .quiz-container::before {
            content: '';
            position: absolute;
            top: 0; left: -50%;
            width: 100%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
            transform: skewX(-25deg);
            pointer-events: none;
        }

        .menu-card h2 { margin: 0 0 8px 0; font-size: 1.3rem; color: #004e92; text-shadow: 0 1px 0 rgba(255,255,255,0.8); }
        .menu-card p { margin: 0 0 20px 0; color: #444; font-size: 0.95rem; line-height: 1.4; }

        /* Badges */
        .status-badge {
            display: inline-block; font-size: 0.7rem; padding: 4px 10px;
            border-radius: 20px; 
            background: linear-gradient(to bottom, #f0f0f0, #d9d9d9);
            border: 1px solid #ccc;
            color: #555;
            margin-bottom: 12px; font-weight: 700; text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .active-card .status-badge { background: linear-gradient(to bottom, #d4edda, #c3e6cb); color: #155724; border-color: #b1dfbb; }
        .update-card .status-badge { background: linear-gradient(to bottom, #d1ecf1, #bee5eb); color: #0c5460; border-color: #abdde5; }

        /* --- GLOSSY BUTTONS --- */
        .menu-sub-options { display: flex; gap: 12px; margin-top: auto; flex-wrap: wrap; }
        
        .btn-action, .control-btn, .option-btn, .setup-btn {
            -webkit-user-select: none;
            user-select: none;
            position: relative;
            z-index: 2;
            cursor: pointer;
            border: none;
            font-family: inherit;
        }

        .btn-action {
            flex: 1; padding: 12px 15px; 
            border-radius: 12px;
            font-weight: 600; font-size: 0.9rem;
            min-width: 100px;
            color: #333;
            background: linear-gradient(180deg, #ffffff 0%, #f0f0f0 100%);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,1);
            border: 1px solid rgba(255,255,255,0.6);
            transition: all 0.1s ease;
        }
        
        .btn-action:active { 
            transform: translateY(2px); 
            box-shadow: 0 1px 2px rgba(0,0,0,0.1), inset 0 1px 2px rgba(0,0,0,0.1); 
        }

        /* Color Variants for Buttons */
        .btn-flash { color: #0056b3; background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 100%); border-color: #90caf9; }
        .btn-quiz { color: #155724; background: linear-gradient(180deg, #e8f5e9 0%, #c3e6cb 100%); border-color: #a5d6a7; }
        .btn-summary { color: #856404; background: linear-gradient(180deg, #fff3cd 0%, #ffeeba 100%); border-color: #ffe8a1; }
        .btn-update { color: #004085; background: linear-gradient(180deg, #cce5ff 0%, #b8daff 100%); border-color: #b8daff; }

        /* --- FLASHCARDS --- */
        .scene { 
            width: 100%; height: 380px; 
            perspective: 1000px; margin: 20px 0; 
            touch-action: pan-y;
        }
        .card { 
            width: 100%; height: 100%; position: relative; 
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-style: preserve-3d; 
            border-radius: 24px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); 
            transform: translateZ(0); 
        }
        .card.is-flipped { transform: rotateY(180deg); }
        
        .card__face {
            position: absolute; width: 100%; height: 100%; 
            backface-visibility: hidden; -webkit-backface-visibility: hidden; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 30px; box-sizing: border-box; text-align: center; border-radius: 24px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.8);
            transform: translateZ(0); 
        }
        
        .card__face--front { 
            color: #004e92; 
        }
        .category-badge {
            background: #e1f5fe; color: #0277bd; padding: 6px 12px;
            border-radius: 20px; font-size: 0.8rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 20px;
        }
        #fc-question { font-size: 1.3rem; font-weight: 600; line-height: 1.4; }

        .card__face--back { 
            background: linear-gradient(135deg, #005c97 0%, #363795 100%);
            color: white; 
            transform: rotateY(180deg); 
            overflow-y: auto;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .controls { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
        .control-btn { 
            padding: 14px 35px; 
            border-radius: 30px; font-weight: 600; color: white;
            background: linear-gradient(to bottom, #00b4db, #0083b0);
            box-shadow: 0 4px 15px rgba(0, 131, 176, 0.4);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.2s;
        }
        .control-btn:active { transform: scale(0.95); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* --- QUIZ --- */
        .setup-grid { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .setup-btn {
            background: white; padding: 18px;
            border-radius: 15px; font-size: 1rem; font-weight: 600;
            color: #444; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .setup-btn:active { transform: scale(0.98); background: #f0f8ff; border-color: #007bff; }
        .setup-btn span { color: #bbb; }
        
        .setup-btn.challenge { 
            background: linear-gradient(to right, #fff8e1, #fff); 
            border: 1px solid #ffe082; color: #b7791f; 
        }

        .quiz-options { display: flex; flex-direction: column; gap: 12px; margin-top: 15px; }
        .option-btn { 
            padding: 18px; background: rgba(255,255,255,0.8); 
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 12px; text-align: left; 
            font-size: 1rem; color: #333; line-height: 1.4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .option-btn:active { background: #f0f0f0; transform: scale(0.99); }
        
        .option-btn.correct { background: #d4edda; border-color: #c3e6cb; color: #155724; box-shadow: inset 0 0 0 2px #c3e6cb; }
        .option-btn.wrong { background: #f8d7da; border-color: #f5c6cb; color: #721c24; box-shadow: inset 0 0 0 2px #f5c6cb; }
        
        .quiz-feedback { 
            margin-top: 25px; padding: 20px; border-radius: 12px; 
            background: rgba(255,255,255,0.9); 
            border-left: 5px solid #ccc; display: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* --- CONTENT --- */
        .sum-card { margin-bottom: 25px; }
        .sum-card h3 { color: #0056b3; border-bottom: 2px solid rgba(0,0,0,0.05); }
        .highlight-box { background: rgba(0, 123, 255, 0.1); color: #004085; font-weight: 600; border-left: 4px solid #007bff; }

        .red-flag { border-top: 4px solid #dc3545; background: rgba(255,245,245,0.9); }
        .red-flag h3 { color: #dc3545; }

        footer { margin-top: auto; padding: 40px; text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8rem; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
    </style>
</head>
<body>

<header>
    <button class="home-btn" id="homeBtn" onclick="goHome()">‚Üê</button>
    <div class="header-text">
        <h1 id="pageTitle">DCAS Review Hub</h1>
        <p id="pageSubtitle">2025 Guidelines</p>
    </div>
</header>

<main>
    <div id="home-section" class="section active">
        <div class="menu-grid">
            <div class="menu-card update-card">
                <div><span class="status-badge">New</span> <h2>2025 Updates Summary</h2> <p>Key changes, new toxicology & foundation protocols.</p></div>
                <div class="menu-sub-options"><button class="btn-action btn-update" onclick="startUpdates()">Read Updates</button></div>
            </div>
            <div class="menu-card active-card">
                <div><span class="status-badge">Module 1.1</span> <h2>Universal Care</h2> <p>Primary Survey, Vitals, Safety & Resuscitation.</p></div>
                <div class="menu-sub-options">
                    <button class="btn-action btn-summary" onclick="startSummary()">Summary</button>
                    <button class="btn-action btn-flash" onclick="startFlashcards()">Flashcards</button>
                    <button class="btn-action btn-quiz" onclick="openQuizSetup()">Quiz</button>
                </div>
            </div>
            <div class="menu-card" style="opacity: 0.8;"><div><span class="status-badge">Stay Tuned</span> <h2>1.2 Documentation</h2></div></div>
            <div class="menu-card" style="opacity: 0.8;"><div><span class="status-badge">Stay Tuned</span> <h2>1.3 Triage Categories</h2></div></div>
        </div>
    </div>

    <div id="updates-section" class="section">
        <div class="sum-card" style="border-top-color: #17a2b8;">
            <h3 style="color: #17a2b8;">1. Major Structural Changes</h3>
            <ul>
                <li><strong>Universal Care:</strong> New "Foundation" chapter applying to ALL patients (Documentation, Triage, Refusal) before specific care.</li>
                <li><strong>General Medical:</strong> Expanded and split into specific guidelines (e.g., Sepsis, Anaphylaxis) instead of one large section.</li>
            </ul>
        </div>
        <div class="sum-card" style="border-top-color: #17a2b8;">
            <h3 style="color: #17a2b8;">2. New Clinical Guidelines</h3>
            <ul>
                <li><strong>Toxicology (Major Update):</strong> New "General Toxicology" foundation added.</li>
                <li><strong>New Specific Protocols:</strong> Opioid Overdose, Beta-Blocker Overdose, Calcium Channel Blocker Overdose, Organophosphates.</li>
                <li><strong>Alcohol:</strong> New "Suspected Alcohol Intoxication" guideline.</li>
                <li><strong>Airway:</strong> Invasive (Mechanical) Ventilation added.</li>
            </ul>
        </div>
        <div class="sum-card">
            <h3>3. Resuscitation & Pediatrics</h3>
            <ul>
                <li><strong>Newborns:</strong> Specific resuscitation for infants under 4 weeks and pre-term.</li>
                <li><strong>Separation:</strong> Adult and Pediatric Cardiac Arrest pathways are now clearly separated.</li>
                <li><strong>Post-ROSC:</strong> New guidance added for care after return of circulation.</li>
            </ul>
        </div>
        <div class="sum-card">
            <h3>4. Operations & Safety</h3>
            <ul>
                <li><strong>Scope of Practice:</strong> New matrix defining allowed skills per clinical level.</li>
                <li><strong>Medication Formulary:</strong> Specific section detailing available medications.</li>
            </ul>
        </div>
        <button class="control-btn" onclick="goHome()" style="width: 100%; margin-top: 20px;">Back to Home</button>
    </div>

    <div id="summary-section" class="section">
        <div class="sum-card">
            <h3>Assessment Sequences</h3>
            <ul>
                <li><strong>Trauma:</strong> C-A-B-C (Catastrophic Hemorrhage, Airway, Breathing, Circulation).</li>
                <li><strong>Medical:</strong> A-B-C (Airway, Breathing, Circulation).</li>
                <li><strong>Cardiac Arrest:</strong> C-A-B (Compressions, Airway, Breathing).</li>
                <li><strong>General Impression:</strong> Appearance, Work of Breathing, Circulation (Skin).</li>
            </ul>
        </div>
        <div class="sum-card red-flag">
            <h3>CRITICAL RED FLAGS</h3>
            <ul>
                <li>Apnea or Pulselessness.</li>
                <li>Altered Mental Status (GCS less than 15).</li>
                <li>Severe Hypoxia (SpO2 less than 90%) or Hypotension (SBP less than 90mmHg).</li>
            </ul>
            <div class="highlight-box">KPI: Request ALS Backup within 1 minute.</div>
        </div>
        <div class="sum-card">
            <h3>Vital Signs Goals</h3>
            <ul>
                <li><strong>SpO2:</strong> >94% (88-92% for COPD).</li>
                <li><strong>Hypotension:</strong> SBP < 90 mmHg.</li>
                <li><strong>Hypoglycemia:</strong> BGL < 70 mg/dl.</li>
                <li><strong>EtCO2:</strong> 35-45 mmHg.</li>
            </ul>
        </div>
        <button class="control-btn" onclick="goHome()" style="width: 100%; margin-top: 20px;">Back to Home</button>
    </div>

    <div id="flashcard-section" class="section">
        <div style="text-align: center; color: rgba(255,255,255,0.8); margin-bottom: 15px; font-weight: 500;" id="fc-progress">Card 1 of 60</div>
        <div class="scene" id="cardScene">
            <div class="card" id="flashcard">
                <div class="card__face card__face--front">
                    <span class="category-badge" id="fc-category">Topic</span>
                    <div id="fc-question" style="white-space: pre-wrap;">Question</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 20px; text-transform: uppercase; letter-spacing: 1px;">Tap to Flip</div>
                </div>
                <div class="card__face card__face--back">
                    <div id="fc-answer" style="white-space: pre-wrap;">Answer</div>
                </div>
            </div>
        </div>
        <div class="controls">
            <button class="control-btn" onclick="prevCard()">Previous</button>
            <button class="control-btn" onclick="nextCard()">Next</button>
        </div>
        <div style="text-align: center; margin-top: 25px;">
             <button onclick="goHome()" style="background: none; border: none; color: rgba(255,255,255,0.7); text-decoration: underline; cursor: pointer;">Back to Home</button>
        </div>
    </div>

    <div id="quiz-setup-section" class="section">
        <div class="quiz-setup-container">
            <h2 class="setup-title" style="color: #0056b3;">Quiz Settings</h2>
            <p style="color: #666; margin-bottom: 25px;">Select the number of questions to practice</p>
            <div class="setup-grid">
                <button class="setup-btn" onclick="initQuiz(10)">10 Questions <span>‚Üí</span></button>
                <button class="setup-btn" onclick="initQuiz(20)">20 Questions <span>‚Üí</span></button>
                <button class="setup-btn" onclick="initQuiz(30)">30 Questions <span>‚Üí</span></button>
                <button class="setup-btn challenge" onclick="initQuiz(60)">Challenge Mode (60) <span>‚Üí</span></button>
            </div>
            <button onclick="goHome()" style="margin-top: 30px; background: none; border: none; color: #666; text-decoration: underline; cursor: pointer;">Cancel</button>
        </div>
    </div>

    <div id="quiz-game-section" class="section">
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px; color: rgba(255,255,255,0.9); font-size: 0.95rem; font-weight: 600;">
            <span id="quiz-progress">Q 1/10</span>
            <span>Score: <strong id="current-score" style="color: #fff;">0</strong></span>
        </div>
        <div class="quiz-container">
            <div class="quiz-question" id="q-text" style="font-size: 1.15rem; font-weight: 600; margin-bottom: 20px; color: #222;">Loading...</div>
            <div class="quiz-options" id="q-options"></div>
            <div class="quiz-feedback" id="q-feedback">
                <strong style="display: block; margin-bottom: 5px;" id="feedback-title">Explanation</strong>
                <span id="feedback-text"></span>
            </div>
            <button class="control-btn" id="next-q-btn" onclick="nextQuestion()" style="width: 100%; margin-top: 25px; display: none;">Next Question</button>
        </div>
    </div>

    <div id="quiz-results" class="section" style="text-align: center;">
        <div class="quiz-setup-container">
            <h2 class="setup-title">Quiz Complete!</h2>
            <div style="font-size: 3.5rem; font-weight: bold; color: #0056b3; margin: 20px 0;" id="final-score">0%</div>
            <p id="final-msg" style="color: #666; margin-bottom: 30px;">Result</p>
            <button class="control-btn" onclick="openQuizSetup()">Retake Quiz</button>
            <br><br>
            <button onclick="goHome()" style="background: none; border: none; color: #666; text-decoration: underline; cursor: pointer;">Back to Home</button>
        </div>
    </div>

</main>

<footer>
    <div>Created by Soliman Anas</div>
    <div style="margin-top: 5px; opacity: 0.6; font-size: 0.7rem;">Disclaimer: Study aid only. Refer to official DCAS CPG & Memos for clinical protocols. </div>
</footer>

<script>
    // --- GLOBAL DATA & FUNCTIONS ---
    
    const masterQuestionBank = [
        { q: "What is the assessment sequence for a Trauma patient?", options: ["A-B-C-D-E", "C-A-B-C", "D-R-A-B-C", "M-A-R-C-H"], correct: 1, explanation: "In trauma, 'C' (Catastrophic Hemorrhage & C-Spine) comes first. The sequence is C-A-B-C: Catastrophic Hemorrhage, Airway, Breathing, Circulation." },
        { q: "What is the assessment sequence for a Medical patient?", options: ["A-B-C-D-E", "C-A-B-C", "D-R-A-B-C", "Safety-First"], correct: 0, explanation: "Medical patients follow the standard A-B-C sequence: Airway, Breathing, Circulation, Disability, Exposure." },
        { q: "What is the assessment sequence for a patient in Cardiac Arrest?", options: ["A-B-C", "C-A-B", "D-R-A-B-C", "B-A-C"], correct: 1, explanation: "Cardiac Arrest prioritizes Circulation (Compressions) to circulate oxygenated blood immediately. Sequence: C-A-B." },
        { q: "What are the 3 elements of the 'General Impression'?", options: ["Airway, Breathing, Circ", "Appearance, Breathing, Activity", "Alertness, Bleeding, Color", "Age, Body type, Complaint"], correct: 1, explanation: "General Impression consists of: 1. Appearance, 2. Work of Breathing, and 3. Activity (Mental Status)." },
        { q: "In the AVPU scale, what does 'P' stand for?", options: ["Pulse", "Pain", "Pupils", "Pallor"], correct: 1, explanation: "AVPU stands for: Alert, Verbal (responds to voice), Pain (responds to pain/pressure), Unresponsive." },
        { q: "Where do you check the pulse on an unconscious adult?", options: ["Radial", "Carotid", "Femoral", "Brachial"], correct: 1, explanation: "The Carotid pulse is the central pulse checked in unconscious adults. Radial is for conscious adults." },
        { q: "Where do you check the pulse on an infant (<1 year)?", options: ["Carotid", "Brachial", "Radial", "Popliteal"], correct: 1, explanation: "Check the Brachial pulse (upper arm) in infants. Their necks are often too short/chubby to reliably find a carotid." },
        { q: "Normal capillary refill time (CRT) is less than:", options: ["1 second", "2 seconds", "3 seconds", "5 seconds"], correct: 1, explanation: "Normal CRT is < 2 seconds. Delayed CRT (>2s) indicates poor perfusion or shock." },
        { q: "What is the absolute FIRST step in any call?", options: ["Airway", "Scene Safety", "Circulation", "Call Dispatch"], correct: 1, explanation: "Scene Safety is always the first priority. You cannot help the patient if you become a patient." },
        { q: "What does 'D' stand for in the primary survey ABCDE?", options: ["Deformity", "Disability", "Danger", "Disease"], correct: 1, explanation: "Disability. This involves a rapid neurological check: GCS, Pupils, and Blood Glucose Level." },
        { q: "What is the normal respiratory rate for an adult?", options: ["8-12", "12-20", "20-30", "10-25"], correct: 1, explanation: "12-20 breaths per minute is the normal range for a healthy adult at rest." },
        { q: "What is the normal heart rate for an adult?", options: ["50-90", "60-100", "70-110", "60-90"], correct: 1, explanation: "60-100 beats per minute. <60 is Bradycardia, >100 is Tachycardia." },
        { q: "What is the target SpO2 for a standard medical patient?", options: ["100%", ">94%", "88-92%", ">90%"], correct: 1, explanation: "Aim for 94-98%. Do not over-oxygenate (hyperoxia) as it can cause vasoconstriction." },
        { q: "What is the target SpO2 for a COPD patient?", options: ["100%", "94-98%", "88-92%", ">95%"], correct: 2, explanation: "88-92%. COPD patients rely on a hypoxic drive; too much oxygen can suppress their breathing." },
        { q: "Hypotension in an adult is generally defined as SBP below:", options: ["110 mmHg", "100 mmHg", "90 mmHg", "80 mmHg"], correct: 2, explanation: "Systolic Blood Pressure < 90 mmHg is the standard threshold for hypotension/shock." },
        { q: "You initiate Hypoglycemia treatment if BGL is below:", options: ["80 mg/dl", "70 mg/dl", "60 mg/dl", "100 mg/dl"], correct: 1, explanation: "Treat with D10/Glucagon if Blood Glucose is < 70 mg/dl and the patient is symptomatic." },
        { q: "What does EtCO2 monitoring measure?", options: ["Oxygen in blood", "Carbon dioxide exhaled", "Carbon monoxide", "pH balance"], correct: 1, explanation: "End-Tidal CO2 measures the amount of Carbon Dioxide in exhaled air. It is the gold standard for tube placement and CPR quality." },
        { q: "What is the normal range for EtCO2?", options: ["20-30 mmHg", "35-45 mmHg", "45-55 mmHg", "90-100 mmHg"], correct: 1, explanation: "35-45 mmHg is the normal physiological range for EtCO2." },
        { q: "Tachycardia is defined as a heart rate greater than:", options: ["90 bpm", "100 bpm", "110 bpm", "120 bpm"], correct: 1, explanation: "Heart rate > 100 bpm is Tachycardia." },
        { q: "Bradycardia is defined as a heart rate less than:", options: ["50 bpm", "60 bpm", "70 bpm", "55 bpm"], correct: 1, explanation: "Heart rate < 60 bpm is Bradycardia." },
        { q: "In DCAP-BTLS, what does 'S' stand for?", options: ["Severity", "Swelling", "Saturation", "Shock"], correct: 1, explanation: "DCAP-BTLS: Deformities, Contusions, Abrasions, Punctures, Burns, Tenderness, Lacerations, Swelling." },
        { q: "In SAMPLE history, what does the 'L' stand for?", options: ["Last oral intake", "Last menstrual period", "Level of consciousness", "Location"], correct: 0, explanation: "SAMPLE: Signs/Symptoms, Allergies, Medications, Past History, Last oral intake, Events leading up." },
        { q: "In SAMPLE history, what does the 'E' stand for?", options: ["Events", "Exposure", "Environment", "Emergency"], correct: 0, explanation: "SAMPLE: Signs/Symptoms, Allergies, Medications, Past History, Last oral intake, Events leading up." },
        { q: "In OPQRST (pain), what does 'P' stand for?", options: ["Past History", "Provocation/Palliation", "Pain Score", "Pulse"], correct: 1, explanation: "OPQRST: Onset, Provocation/Palliation (what makes it better/worse), Quality, Radiation, Severity, Time." },
        { q: "In OPQRST (pain), what does 'R' stand for?", options: ["Rate", "Rhythm", "Radiation", "Respiration"], correct: 2, explanation: "OPQRST: Onset, Provocation, Quality, Radiation (does pain move?), Severity, Time." },
        { q: "In IMIST-AMBO handover, what does 'A' stand for?", options: ["Airway", "Alertness", "Allergies", "Age"], correct: 2, explanation: "AMBO: Allergies, Medications, Background History, Other information." },
        { q: "In IMIST-AMBO handover, what does 'M' stand for?", options: ["Mechanism", "Medications", "Medical Hx", "Movement"], correct: 1, explanation: "AMBO: Allergies, Medications, Background History, Other information." },
        { q: "Which mnemonic is used for Stroke Assessment?", options: ["SAMPLE", "BEFAST", "OPQRST", "AEIOU"], correct: 1, explanation: "BEFAST: Balance, Eyes, Face, Arms, Speech, Time." },
        { q: "GCS: What score is given for 'Confused' verbal response?", options: ["5", "4", "3", "2"], correct: 1, explanation: "Verbal: 5=Oriented, 4=Confused, 3=Inappropriate Words, 2=Incomprehensible Sounds, 1=None." },
        { q: "GCS: What score is given for 'Spontaneous' eye opening?", options: ["4", "3", "2", "1"], correct: 0, explanation: "Eyes: 4=Spontaneous, 3=To Voice, 2=To Pain, 1=None." },
        { q: "What is the adult CPR Compression:Breath ratio (single rescuer)?", options: ["15:2", "30:2", "10:1", "Continuous"], correct: 1, explanation: "30 compressions to 2 breaths (30:2) for adults." },
        { q: "What is the pediatric CPR ratio (2 rescuers)?", options: ["30:2", "15:2", "5:1", "10:2"], correct: 1, explanation: "For children/infants with TWO rescuers, use 15:2. If single rescuer, use 30:2." },
        { q: "What is the correct compression rate for CPR?", options: ["60-80/min", "80-100/min", "100-120/min", "120-140/min"], correct: 2, explanation: "Compress at a rate of 100-120 beats per minute." },
        { q: "What is the correct compression depth for adults?", options: ["At least 5cm (2 inches)", "3 cm", "6-7 cm", "1/3 depth"], correct: 0, explanation: "Compress at least 5cm (2 inches) but no more than 6cm (2.4 inches)." },
        { q: "How often should you switch compressors during CPR?", options: ["Every 1 min", "Every 2 mins", "Every 5 mins", "When tired"], correct: 1, explanation: "Switch every 2 minutes (approx 5 cycles) to maintain high-quality compressions." },
        { q: "What is the maximum interruption time allowed for breaths/checks?", options: ["5 seconds", "10 seconds", "15 seconds", "20 seconds"], correct: 1, explanation: "Interruptions should be minimized to less than 10 seconds." },
        { q: "Where is the correct hand placement for adult CPR?", options: ["Upper half of sternum", "Lower half of sternum", "Left side of chest", "Right side of chest"], correct: 1, explanation: "Place hands on the lower half of the sternum (center of the chest)." },
        { q: "With an advanced airway (ETT/SGA) in place, how do you breathe?", options: ["Pause for 2 breaths every 30", "1 breath every 6 secs", "1 breath every 3 secs", "Asynchronous"], correct: 1, explanation: "Provide 1 breath every 6 seconds (10/min) without pausing compressions." },
        { q: "What is the first drug administered in Cardiac Arrest (Non-Shockable)?", options: ["Amiodarone", "Atropine", "Adrenaline (Epi)", "Lidocaine"], correct: 2, explanation: "Adrenaline (Epinephrine) 1mg is the first line vasopressor for Asystole/PEA." },
        { q: "What is the standard energy setting for Adult Biphasic Defibrillation?", options: ["100J", "120-200J", "360J", "50J"], correct: 1, explanation: "Manufacturer specific, but typically starts at 120-200 Joules." },
        { q: "How far should you park from a burning vehicle?", options: ["15m", "30m", "50m", "100m"], correct: 2, explanation: "A safe distance is typically at least 30-50m, ideally uphill and upwind." },
        { q: "In HazMat incidents, which zone is the 'Hot Zone'?", options: ["Support zone", "Contamination zone", "Safe zone", "Hospital zone"], correct: 1, explanation: "Hot Zone = Contamination; Warm Zone = Decon; Cold Zone = Support/Command." },
        { q: "True or False: Imminent Birth is an exclusion for Airwing transport?", options: ["True", "False"], correct: 0, explanation: "True. Delivering a baby in a helicopter is dangerous due to space/equipment limits. Ground transport is preferred." },
        { q: "True or False: Violent patients are eligible for Airwing transport?", options: ["True", "False"], correct: 1, explanation: "False. Violent patients pose a catastrophic safety risk to the aircraft and crew." },
        { q: "How often do you reassess a 'Green' (Non-Critical) patient?", options: ["5 min", "10 min", "15 min", "30 min"], correct: 2, explanation: "Stable/Green patients require reassessment every 15 minutes." },
        { q: "How often do you reassess a 'Red' (Critical) patient?", options: ["5 min", "10 min", "15 min", "Continuous"], correct: 0, explanation: "Critical/Red patients must be reassessed every 5 minutes." },
        { q: "What PPE is required for Standard Precautions?", options: ["Gloves only", "Gloves & Glasses", "Gloves, Mask, Glasses, Gown (Risk-based)", "Mask only"], correct: 2, explanation: "Standard precautions require assuming all fluids are infectious. Use Gloves, Mask, Eye protection, and Gown based on exposure risk." },
        { q: "When lifting, you should primarily use your:", options: ["Back", "Legs/Hips", "Arms", "Shoulders"], correct: 1, explanation: "Lift with your legs and hips (power lift), keeping your back straight and the weight close to your body." },
        { q: "When is a Tourniquet indicated?", options: ["Minor cuts", "Venous bleeding", "Uncontrolled arterial limb bleed", "Head wounds"], correct: 2, explanation: "Tourniquets are for life-threatening arterial hemorrhage on limbs that cannot be controlled by direct pressure." },
        { q: "What is the 'Golden Hour' in trauma?", options: ["Time to eat", "Time from injury to surgery", "Time on scene", "Time to call dispatch"], correct: 1, explanation: "It is the window of time (approx 1 hour) from injury to definitive surgical care where survival rates are highest." },
        { q: "The Pediatric Assessment Triangle (PAT) consists of Appearance, Circulation, and:", options: ["Airway", "Work of Breathing", "Bleeding", "Alertness"], correct: 1, explanation: "PAT = Appearance, Work of Breathing, and Circulation to Skin." },
        { q: "In Dubai CPGs, a pediatric patient is defined as age:", options: ["<12", "<=13", "<16", "<18"], correct: 1, explanation: "Pediatric protocols generally apply to children aged 13 years and under." },
        { q: "What is a late sign of shock (decompensation) in children?", options: ["Tachycardia", "Hypotension", "Crying", "Fever"], correct: 1, explanation: "Children maintain BP for a long time. Hypotension indicates imminent collapse (decompensated shock)." },
        { q: "Where do you check a pulse on a newborn?", options: ["Carotid", "Brachial / Apical", "Femoral", "Radial"], correct: 1, explanation: "Brachial artery or auscultate the Apical pulse (chest)." },
        { q: "What rule is used to estimate Burn Surface Area in adults?", options: ["Rule of 9s", "Rule of Palms", "Broselow Tape", "Parkland Formula"], correct: 0, explanation: "The Rule of Nines is the standard method for estimating Total Body Surface Area (TBSA) burned." },
        { q: "According to Rule of 9s, one adult arm (entire) is:", options: ["4.5%", "9%", "18%", "1%"], correct: 1, explanation: "The entire arm (front and back) accounts for 9% TBSA." },
        { q: "According to Rule of 9s, the adult anterior torso (Chest+Abdomen) is:", options: ["9%", "18%", "36%", "1%"], correct: 1, explanation: "Chest (9%) + Abdomen (9%) = 18%." },
        { q: "What is the best position for a shock patient (no spinal injury)?", options: ["Sitting up", "Supine", "Prone", "Recovery"], correct: 1, explanation: "Supine (flat on back). Elevating legs is controversial; flat is generally best to maximize blood flow to the brain." },
        { q: "The Recovery Position is primarily used for:", options: ["Cardiac arrest", "Unconscious breathing patient", "Spinal injury", "Shock"], correct: 1, explanation: "It maintains the airway and prevents aspiration in unconscious patients who are breathing spontaneously." },
        { q: "What flow rate is used for a Non-Rebreather Mask (NRB)?", options: ["2-6 LPM", "6-10 LPM", "10-15 LPM", "25 LPM"], correct: 2, explanation: "10-15 LPM is required to keep the reservoir bag inflated and deliver high concentrations (90%+) of Oxygen." }
    ];

    const flashcards = [
        { category: "Primary Survey", question: "What is the assessment sequence for a Trauma patient?", answer: "C - A - B - C\n\n1. Catastrophic Hemorrhage (Control it first!)\n2. Airway (with C-Spine control)\n3. Breathing\n4. Circulation" },
        { category: "Primary Survey", question: "What is the assessment sequence for a Medical patient?", answer: "A - B - C\n\n1. Airway\n2. Breathing\n3. Circulation\n(Followed by Disability & Exposure)" },
        { category: "Primary Survey", question: "What is the assessment sequence for Cardiac Arrest?", answer: "C - A - B\n\n1. Circulation (Compressions start immediately)\n2. Airway\n3. Breathing\n\nReason: Oxygenated blood must be circulated to the brain first." },
        { category: "Primary Survey", question: "What are the 3 elements of the 'General Impression'?", answer: "1. Appearance (Muscle tone, interactivity)\n2. Work of Breathing (Noises, posture)\n3. Circulation to Skin (Color, condition)" },
        { category: "Primary Survey", question: "What does 'AVPU' stand for?", answer: "A - Alert (Eyes open, tracking)\nV - Verbal (Responds to voice)\nP - Pain (Responds to pain/pressure)\nU - Unresponsive (No response)" },
        { category: "Primary Survey", question: "What is the first priority at any scene?", answer: "Scene Safety\n\nEnsure the safety of yourself, your crew, the public, and then the patient." },
        { category: "Primary Survey", question: "What is the 'Golden Hour' in trauma cases?", answer: "The 60-minute window from injury to surgical care.\n\nSurvival rates drop significantly if a trauma patient isn't in the OR within this hour." },
        { category: "Primary Survey", question: "What defines a 'Critical' (Red) Trauma patient?", answer: "Compromised ABCD, Altered Mental Status, or Significant Mechanism of Injury requiring immediate transport." },
        { category: "Primary Survey", question: "Where do you check a pulse on an Unconscious Adult?", answer: "Carotid Artery (Neck)\n\nCheck for at least 5 seconds, but no more than 10." },
        { category: "Primary Survey", question: "Where do you check a pulse on an Infant?", answer: "Brachial Artery (Upper Arm)\n\nThe neck is often too short or chubby to find a carotid pulse reliably." },
        { category: "Vitals", question: "Normal Adult Pulse Rate?", answer: "60 - 100 beats per minute\n\n<60 = Bradycardia\n>100 = Tachycardia" },
        { category: "Vitals", question: "Normal Adult Respiratory Rate?", answer: "12 - 20 breaths per minute\n\n<12 = Bradypnea\n>20 = Tachypnea" },
        { category: "Vitals", question: "Normal Capillary Refill Time (CRT)?", answer: "Less than 2 seconds\n\nDelayed refill (>2s) suggests poor perfusion (shock)." },
        { category: "Vitals", question: "Target SpO2 for general patients?", answer: "> 94% (94-98%)\n\nAvoid 100% unless Carbon Monoxide poisoning is suspected." },
        { category: "Vitals", question: "Target SpO2 for COPD patients?", answer: "88% - 92%\n\nHigher oxygen levels can suppress their hypoxic drive to breathe." },
        { category: "Vitals", question: "Definition of Hypotension (Adult)?", answer: "Systolic Blood Pressure < 90 mmHg\n\nRequires fluid resuscitation if symptomatic." },
        { category: "Vitals", question: "Normal Blood Glucose Level (BGL)?", answer: "70 - 140 mg/dl\n\nHypoglycemia protocol starts at < 70 mg/dl." },
        { category: "Vitals", question: "What is EtCO2 used for?", answer: "End-Tidal CO2 monitoring\n\nNormal Range: 35-45 mmHg.\nUsed to confirm tube placement and monitor CPR quality." },
        { category: "Vitals", question: "What constitutes a Fever?", answer: "Temperature > 38.0¬∞C (100.4¬∞F)\n\nSepsis Alert if accompanied by infection signs." },
        { category: "Vitals", question: "Pulse Pressure Definition?", answer: "The difference between Systolic and Diastolic BP.\n\nNarrowing pulse pressure is an early sign of shock." },
        { category: "Mnemonic", question: "Explain 'DCAP-BTLS' (Trauma Survey)", answer: "D - Deformities\nC - Contusions\nA - Abrasions\nP - Punctures\n\nB - Burns\nT - Tenderness\nL - Lacerations\nS - Swelling" },
        { category: "Mnemonic", question: "Explain 'SAMPLE' (History Taking)", answer: "S - Signs/Symptoms\nA - Allergies\nM - Medications\nP - Past History\nL - Last Oral Intake\nE - Events leading up" },
        { category: "Mnemonic", question: "Explain 'OPQRST' (Pain Assessment)", answer: "O - Onset (Active vs Rest)\nP - Provocation (Better/Worse?)\nQ - Quality (Sharp/Dull?)\nR - Radiation (Moves?)\nS - Severity (0-10)\nT - Time (Duration)" },
        { category: "Mnemonic", question: "Explain 'IMIST-AMBO' (Handover)", answer: "I - Identification\nM - Mechanism/Medical Complaint\nI - Injuries\nS - Signs (Vitals)\nT - Treatment\n\nA - Allergies\nM - Medications\nB - Background\nO - Other info" },
        { category: "Mnemonic", question: "Explain 'BEFAST' (Stroke)", answer: "B - Balance (Loss of)\nE - Eyes (Blurred vision)\nF - Face (Droop)\nA - Arms (Drift)\nS - Speech (Slurred)\nT - Time (Last seen normal)" },
        { category: "Mnemonic", question: "Explain 'AEIOU-TIPS' (Altered Mental Status)", answer: "A - Alcohol\nE - Epilepsy\nI - Insulin\nO - Overdose\nU - Uremia\n\nT - Trauma\nI - Infection\nP - Psychosis\nS - Stroke" },
        { category: "Mnemonic", question: "Explain 'PASTE' (Respiratory)", answer: "P - Provocation\nA - Associated Chest Pain\nS - Sputum (Color/Amount)\nT - Talking tiredness (Words per breath)\nE - Exacerbation" },
        { category: "Mnemonic", question: "Explain 'APGAR' (Newborn)", answer: "A - Appearance (Color)\nP - Pulse (>100)\nG - Grimace (Reaction)\nA - Activity (Muscle Tone)\nR - Respiration (Cry)\n\nScore 0-2 for each." },
        { category: "Mnemonic", question: "Explain 'DICE' (Drug Calculations)", answer: "D - Drug (Right drug?)\nI - Integrity (Color/Expiry?)\nC - Concentration\nE - Equipment required" },
        { category: "Mnemonic", question: "Explain 'SLUDGE' (Organophosphate Poisoning)", answer: "S - Salivation\nL - Lacrimation (Tears)\nU - Urination\nD - Defecation\nG - GI Upset\nE - Emesis (Vomiting)" },
        { category: "CPR", question: "Adult CPR Ratio (1 or 2 Rescuers)", answer: "30 Compressions : 2 Breaths" },
        { category: "CPR", question: "Pediatric CPR Ratio (2 Rescuers)", answer: "15 Compressions : 2 Breaths\n\n(Use 30:2 if you are alone)" },
        { category: "CPR", question: "Compression Rate", answer: "100 - 120 compressions per minute\n\n(Push hard, push fast)" },
        { category: "CPR", question: "Adult Compression Depth", answer: "5 - 6 cm (2 - 2.4 inches)\n\nAllow full chest recoil." },
        { category: "CPR", question: "Infant Compression Depth", answer: "4 cm (1.5 inches)\n\nOr 1/3 depth of the chest." },
        { category: "CPR", question: "Ventilation Rate with Advanced Airway", answer: "1 breath every 6 seconds\n(10 breaths/min)\n\nDo NOT pause compressions." },
        { category: "CPR", question: "How often to switch compressors?", answer: "Every 2 minutes (approx 5 cycles)\n\nTo prevent fatigue and poor quality compressions." },
        { category: "CPR", question: "Correct Hand Placement (Adult)", answer: "Lower half of the sternum\n(Center of the chest)" },
        { category: "CPR", question: "Shockable Rhythms?", answer: "1. Ventricular Fibrillation (VF)\n2. Pulseless Ventricular Tachycardia (VT)" },
        { category: "CPR", question: "Non-Shockable Rhythms", answer: "1. Asystole (Flatline)\n2. Pulseless Electrical Activity (PEA)" },
        { category: "Operations", question: "Safe Parking Distance (Car Fire)", answer: "At least 30 meters (100 feet)\n\nIdeally uphill and upwind." },
        { category: "Operations", question: "HazMat Zones", answer: "Hot Zone: Contamination\nWarm Zone: Decontamination\nCold Zone: Support/Command (Safe)" },
        { category: "Operations", question: "Airwing Exclusion Criteria", answer: "1. Imminent Birth\n2. Violent/Psychiatric Patients\n3. HazMat Contamination\n4. Cardiac Arrest (Relative)" },
        { category: "Operations", question: "Standard Precautions (PPE)", answer: "Assume ALL body fluids are infectious.\n\nWear: Gloves, Mask, Eye Protection, Gown (as needed)." },
        { category: "Operations", question: "Reassessment: Critical (Red)", answer: "Every 5 minutes\n\nCheck vitals and interventions." },
        { category: "Operations", question: "Reassessment: Stable (Green)", answer: "Every 15 minutes" },
        { category: "Operations", question: "Safe Lifting (Power Lift)", answer: "1. Feet shoulder-width apart\n2. Back straight\n3. Lift with legs (not back)\n4. Keep weight close to body" },
        { category: "Operations", question: "When to use a Tourniquet?", answer: "For life-threatening arterial bleeding on a limb that cannot be controlled by direct pressure." },
        { category: "Operations", question: "Tourniquet Application", answer: "Apply high and tight on the limb.\nTwist until bleeding stops.\nMark time of application." },
        { category: "Operations", question: "Mass Casualty Triage Colors", answer: "Red: Immediate (Life threat)\nYellow: Delayed (Serious but stable)\nGreen: Minor (Walking wounded)\nBlack: Deceased/Expectant" },
        { category: "Pediatrics", question: "Pediatric Age Cutoff", answer: "13 Years and under\n\n(>13 is treated as an adult)" },
        { category: "Pediatrics", question: "Pediatric Assessment Triangle (PAT)", answer: "1. Appearance (Tone, Interactiveness)\n2. Work of Breathing\n3. Circulation to Skin (Mottling, Pallor)" },
        { category: "Pediatrics", question: "Sign of Decompensated Shock (Peds)", answer: "Hypotension\n\nKids compensate well (high HR). Once BP drops, cardiac arrest is imminent." },
        { category: "Pediatrics", question: "Geriatric Definition", answer: "65 Years and older\n\n(High risk for under-triage)" },
        { category: "Burns", question: "Rule of Nines (Adult Arm)", answer: "9% Total Body Surface Area (TBSA)\n(4.5% Front + 4.5% Back)" },
        { category: "Burns", question: "Rule of Nines (Adult Leg)", answer: "18% Total Body Surface Area (TBSA)\n(9% Front + 9% Back)" },
        { category: "Burns", question: "Rule of Nines (Adult Torso)", answer: "Chest = 9%\nAbdomen = 9%\nBack = 18%\nTotal Trunk = 36%" },
        { category: "Special", question: "Position for Shock Patient", answer: "Supine (Flat on back)\n\nKeeps blood flowing to the brain. Keep warm." },
        { category: "Special", question: "Recovery Position", answer: "Lateral Recumbent (On side)\n\nFor unconscious patients with a pulse and breathing (prevents aspiration)." },
        { category: "Special", question: "Oxygen Flow: Non-Rebreather", answer: "10 - 15 Liters Per Minute (LPM)\n\nEnsure the reservoir bag stays inflated." }
    ];

    let currentQuizQueue = [];
    let qIndex = 0;
    let score = 0;
    let fcIndex = 0;

    // --- HELPER: SAFE SCROLL ---
    function safeScrollTop() {
        // Immediate attempt
        window.scrollTo(0, 0);
        document.body.scrollTop = 0; 
        document.documentElement.scrollTop = 0;

        // Forced layout reflow hack to help Android render correctly
        document.body.style.display = 'none';
        document.body.offsetHeight; // trigger reflow
        document.body.style.display = 'flex';

        // Delayed attempt for mobile browsers
        setTimeout(() => {
            window.scrollTo(0, 0);
            document.body.scrollTop = 0; 
            document.documentElement.scrollTop = 0;
        }, 10);
    }

    // --- NAVIGATION ---

    window.goHome = function() {
        // 1. Hide all sections first
        document.querySelectorAll('.section').forEach(el => {
            el.classList.remove('active');
            el.style.display = 'none'; // Force hide for Android scroll reset
        });

        // 2. Scroll to top while content is hidden
        window.scrollTo(0, 0);

        // 3. Show Home
        const home = document.getElementById('home-section');
        home.style.display = 'block';
        setTimeout(() => home.classList.add('active'), 10); // Fade in if transition exists

        document.getElementById('homeBtn').style.display = 'none';
        document.getElementById('pageTitle').innerText = "DCAS Review Hub";
    };

    window.showSection = function(id, title) {
        // 1. Hide all sections first
        document.querySelectorAll('.section').forEach(el => {
            el.classList.remove('active');
            el.style.display = 'none'; // Force hide
        });

        // 2. Scroll to top while content is hidden
        window.scrollTo(0, 0);

        // 3. Show Target Section
        const target = document.getElementById(id);
        target.style.display = 'block';
        setTimeout(() => target.classList.add('active'), 10);

        document.getElementById('homeBtn').style.display = 'block';
        document.getElementById('pageTitle').innerText = title;
    };

    window.startSummary = function() {
        showSection('summary-section', 'Universal Care Summary');
    };

    window.startUpdates = function() {
        showSection('updates-section', '2025 CPG Updates');
    };

    // --- FLASHCARDS LOGIC ---

    window.startFlashcards = function() {
        fcIndex = 0;
        updateFlashcard();
        showSection('flashcard-section', 'Universal Care Flashcards');
    };

    window.updateFlashcard = function() {
        const card = document.getElementById('flashcard');
        card.classList.remove('is-flipped');
        
        setTimeout(() => {
            const data = flashcards[fcIndex];
            document.getElementById('fc-category').innerText = data.category;
            document.getElementById('fc-question').innerText = data.question;
            document.getElementById('fc-answer').innerText = data.answer;
            document.getElementById('fc-progress').innerText = `Card ${fcIndex + 1} of ${flashcards.length}`;
        }, 200);
    };

    window.flipCard = function() {
        document.getElementById('flashcard').classList.toggle('is-flipped');
    };

    window.nextCard = function() {
        if (fcIndex < flashcards.length - 1) { fcIndex++; updateFlashcard(); }
    };

    window.prevCard = function() {
        if (fcIndex > 0) { fcIndex--; updateFlashcard(); }
    };

    // --- QUIZ LOGIC ---

    window.openQuizSetup = function() {
        showSection('quiz-setup-section', 'Quiz Setup');
    };

    window.initQuiz = function(count) {
        const shuffled = [...masterQuestionBank].sort(() => 0.5 - Math.random());
        const actualCount = Math.min(count, shuffled.length);
        currentQuizQueue = shuffled.slice(0, actualCount);
        
        qIndex = 0; score = 0;
        document.getElementById('current-score').innerText = 0;
        loadQuestion();
        
        // Custom logic for Quiz start (skips generic showSection to handle internal divs)
        document.querySelectorAll('.section').forEach(el => {
            el.classList.remove('active');
            el.style.display = 'none';
        });
        window.scrollTo(0,0);

        const gameSection = document.getElementById('quiz-game-section');
        gameSection.style.display = 'block';
        setTimeout(() => gameSection.classList.add('active'), 10);

        document.getElementById('homeBtn').style.display = 'block';
        document.getElementById('pageTitle').innerText = "Clinical Quiz";
        
        // Reset internal quiz visibility
        document.getElementById('quiz-results').style.display = 'none';
    };

    window.loadQuestion = function() {
        const data = currentQuizQueue[qIndex];
        document.getElementById('q-text').innerText = data.q;
        document.getElementById('quiz-progress').innerText = `Q ${qIndex + 1}/${currentQuizQueue.length}`;
        
        const optionsDiv = document.getElementById('q-options');
        optionsDiv.innerHTML = '';
        document.getElementById('q-feedback').style.display = 'none';
        document.getElementById('next-q-btn').style.display = 'none';

        data.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx, btn);
            optionsDiv.appendChild(btn);
        });
        
        window.scrollTo(0,0); // Ensure top of question is seen
    };

    window.checkAnswer = function(selectedIdx, btnElement) {
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(b => b.disabled = true);

        const currentQ = currentQuizQueue[qIndex];
        const correctIdx = currentQ.correct;
        const feedbackBox = document.getElementById('q-feedback');
        const feedbackText = document.getElementById('feedback-text');
        const feedbackTitle = document.getElementById('feedback-title');

        if (selectedIdx === correctIdx) {
            btnElement.classList.add('correct');
            score++;
            feedbackTitle.innerText = "Correct! ‚úÖ";
            feedbackTitle.style.color = "#155724";
            feedbackBox.style.borderLeftColor = "#28a745";
            feedbackBox.style.background = "#d4edda";
        } else {
            btnElement.classList.add('wrong');
            buttons[correctIdx].classList.add('correct');
            feedbackTitle.innerText = "Incorrect ‚ùå";
            feedbackTitle.style.color = "#721c24";
            feedbackBox.style.borderLeftColor = "#dc3545";
            feedbackBox.style.background = "#f8d7da";
        }

        feedbackText.innerText = currentQ.explanation;
        feedbackBox.style.display = 'block';
        document.getElementById('next-q-btn').style.display = 'block';
        document.getElementById('current-score').innerText = score;
        
        feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    };

    window.nextQuestion = function() {
        qIndex++;
        if (qIndex < currentQuizQueue.length) {
            loadQuestion();
        } else {
            // Finish Quiz
            document.getElementById('quiz-game-section').style.display = 'none';
            document.getElementById('quiz-game-section').classList.remove('active');
            
            const resultsSection = document.getElementById('quiz-results');
            resultsSection.style.display = 'block';
            setTimeout(() => resultsSection.classList.add('active'), 10);
            
            const percentage = Math.round((score / currentQuizQueue.length) * 100);
            document.getElementById('final-score').innerText = percentage + '%';
            
            let msg = "Keep Studying!";
            if (percentage >= 80) msg = "Excellent Job!";
            else if (percentage >= 60) msg = "Good Effort.";
            document.getElementById('final-msg').innerText = msg;
            
            window.scrollTo(0,0);
        }
    };
/* --- Are you still interested in my code üòÅ, With love from Soliman Anas --- */
    // Initialize Flashcard Click Listener (Passive for iOS)
    document.addEventListener('DOMContentLoaded', () => {
        const cardScene = document.getElementById("cardScene");
        if(cardScene) {
            cardScene.addEventListener("click", window.flipCard, { passive: true });
        }
    });
</script>
</body>
</html>
